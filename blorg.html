<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>blorg blorg blorg</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="css/base.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script src="js/exercise-list.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <ul class="nav navbar-nav">
      <li>
        <a href="index.html">← index</a>
      </li>
      <li>
        <button type="button"
                class="btn btn-default navbar-btn"
                data-toggle="collapse" data-target="#exercise-list">
          Exercises
        </button>
      </li>
      <li>
        <ul id="exercise-list" class="collapse navbar-text list-inline">
        </ul>
      </li>
  </div>
</nav>
<div class="container">
  <div class="main-content">
<header id="title-block-header">
<h1 class="title">blorg blorg blorg</h1>
</header>
<p>This chapter is special in that there are no exercises. Instead, we
will take an existing project and study its code and development. Some
of the topics covered are:</p>
<ul>
<li>State</li>
<li>Using libraries</li>
<li>Organizing code</li>
<li>The principle of “simple”</li>
</ul>
<section id="get-the-project" class="level2">
<h2>Get the project</h2>
<p>The project is available at:</p>
<pre><code>git clone https://github.com/iloveponies/blorg.git</code></pre>
<p>The project for this chapter contains multiple <em>tags</em> that
identify different phases of the project as it was written. The chapter
text will instruct you to check out a certain tag to see the code as it
was at a specific point in time.</p>
<p>To begin with, check out the tag <code>initial</code> to see the
first version of the code:</p>
<pre><code>git checkout initial</code></pre>
</section>
<section id="the-idea" class="level2">
<h2>The idea</h2>
<p>So far we have programmed various Clojure exercises and at least one
larger project (poker hands). It all feels decidedly… unhipster, though.
It’s hardly <a
href="http://www.mongodb-is-web-scale.com/">webscale</a>!</p>
<p>We want to write a blog engine, and not just any engine, but one
written with Clojure. We also want to use ready-made libraries for
writing web applications instead of inventing our own wheel (as
satisfying it would be). Additionally, we want to keep the
implementation as simple as possible.</p>
<section id="exploratory-coding-or-why-we-dont-have-tests-yet"
class="level3">
<h3>Exploratory coding, or why we don’t have tests yet</h3>
<p>We don’t really know what we’re doing yet; we’re mostly gluing
together existing libraries and defining a very simple model for blog
posts. We decide to not write unit tests, and instead implement a
<em>prototype</em> instead. We are prepared to throw away this code and
reimplement a new version with tests. Alternatively, we might use the
prototype itself as the production version and write tests for it after
the fact.</p>
</section>
</section>
<section id="initial-implementation" class="level2">
<h2>Initial implementation</h2>
<p>Using the <code>initial</code> tag we can see our first
implementation. First, we should take a look at the project definition,
which tells us what libraries we are using. The project definition
resides in the <code>project.clj</code> file in the project root
directory:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>(defproject blorg <span class="st">&quot;0.1.0-SNAPSHOT&quot;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">:dependencies</span> [[org.clojure/clojure <span class="st">&quot;1.4.0&quot;</span>]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                 [noir <span class="st">&quot;1.3.0-beta7&quot;</span>]]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">:main</span> blorg.core)</span></code></pre></div>
<p>This definition tells Leiningen that blorg requires Clojure version
1.4.0 and the <a href="http://webnoir.org">noir</a> library version
1.3.0-beta7. It also specifies that the namespace
<code>blorg.core</code> contains the main function to be called when the
user runs <code>lein run</code>.</p>
<section id="the-first-page" class="level3">
<h3>The first page</h3>
<p>Our initial implementation resides in one file,
<code>src/blorg/core.clj</code>. It contains very little code, so let us
study it. First, let us take a look at the whole file to see the overall
structure. You do not need to understand what each bit does yet; we’ll
go through each part individually.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">ns</span> blorg.core</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  (<span class="at">:use</span> noir.core)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  (<span class="at">:require</span> [noir.server <span class="at">:as</span> server]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>            [hiccup.page <span class="at">:as</span> page]))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> *posts* </span>[{<span class="at">:title</span> <span class="st">&quot;foo&quot;</span> <span class="at">:content</span> <span class="st">&quot;bar&quot;</span>}</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>              {<span class="at">:title</span> <span class="st">&quot;quux&quot;</span> <span class="at">:content</span> <span class="st">&quot;ref ref&quot;</span>}])</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>(defpage <span class="st">&quot;/&quot;</span> []</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  (page/html5</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>   (<span class="kw">for</span> [post *posts*]</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>     [<span class="at">:section</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>      [<span class="at">:h2</span> (<span class="at">:title</span> post)]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>      [<span class="at">:p</span> (<span class="at">:content</span> post)]])))</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> -main </span>[&amp; args]</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">println</span> <span class="st">&quot;&gt; blorg blog blorg&quot;</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  (server/start <span class="dv">8080</span>))</span></code></pre></div>
<p>That is the whole file. Let us run the program to see what it
does:</p>
<pre><code>blorg$ lein run
Compiling blorg.core
Warning: *posts* not declared dynamic and thus is not dynamically rebindable, but its name suggests otherwise. Please either indicate ^:dynamic *posts* or change the name. (blorg/core.clj:6)
Compilation succeeded.
&gt; blorg blog blorg
Starting server...
2012-05-24 12:50:49.775:INFO:oejs.Server:jetty-7.6.1.v20120215
Server started on port [8080].
You can view the site at http://localhost:8080
#&lt;Server org.eclipse.jetty.server.Server@eaecb09&gt;
2012-05-24 12:50:49.819:INFO:oejs.AbstractConnector:Started SelectChannelConnector@0.0.0.0:8080</code></pre>
<p>The output contains one warning, which you we will fix later, and a
bunch of interesting lines about the HTTP server launching. The line
<code>You can view the site at http://localhost:8080</code> sounds
promising. Open that URL in the browser and you should see the first
version of our blog:</p>
<p><a href="img/blorg-initial.png"></p>
<figure>
<img src="img/blorg-initial.png" alt="First version of the blog." />
<figcaption aria-hidden="true">First version of the blog.</figcaption>
</figure>
<p></a></p>
</section>
<section id="the-implementation-of-the-first-page" class="level3">
<h3>The implementation of the first page</h3>
<p>Now that we know what the code does, we can go through each part
individually.</p>
<p>First, we start with a regular namespace declaration, which contains
our <code>use</code> and <code>require</code> declarations:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">ns</span> blorg.core</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  (<span class="at">:use</span> noir.core)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  (<span class="at">:require</span> [noir.server <span class="at">:as</span> server]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>            [hiccup.page <span class="at">:as</span> page]))</span></code></pre></div>
<p>We use <code>noir.core</code>, which imports the function names
defined in that namespace into our own namespace. This means we can
refer to functions in <code>noir.core</code> with just their names, like
we will use <code>defpage</code>.</p>
<p><code>require</code> loads just the namespace and does not import the
functions. We can refer to names defined in the namespace with the
syntax <code>namespace/name</code>. <code>(require 'noir.server)</code>
would let us call <code>noir.server/start-server</code>. As a
convenience shortcut, we give shorter names to the namespaces we
require: <code>noir.server</code> is just <code>server</code> (so we can
say <code>server/start-server</code>) and <code>hiccup.page</code> is
just <code>page</code>.</p>
<p>Next, we define some blog posts to display on the page:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(<span class="bu">def</span><span class="fu"> *posts* </span>[{<span class="at">:title</span> <span class="st">&quot;foo&quot;</span> <span class="at">:content</span> <span class="st">&quot;bar&quot;</span>}</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>              {<span class="at">:title</span> <span class="st">&quot;quux&quot;</span> <span class="at">:content</span> <span class="st">&quot;ref ref&quot;</span>}])</span></code></pre></div>
<p>The <code>*</code> characters are an idiomatic way to indicate that a
name is <em>dynamic</em>, and is a mistake on my part here. We saw that
Clojure actually warned about this; we’ll change the name soon.</p>
<p>At this point, we have decided to represent blog posts as maps with a
title and the content of the blog post. Because using maps in Clojure is
so simple this representation works well without introducing
boilerplate.</p>
<p>Satisfied that we can now represent blog posts, we define our web
page:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(defpage <span class="st">&quot;/&quot;</span> []</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  (page/html5</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>   (<span class="kw">for</span> [post *posts*]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>     [<span class="at">:section</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>      [<span class="at">:h2</span> (<span class="at">:title</span> post)]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>      [<span class="at">:p</span> (<span class="at">:content</span> post)]])))</span></code></pre></div>
<p>We use noir’s <code>defpage</code> to define a page located at the
URL <code>/</code>. It contains a HTML 5 page that lists all the blog
posts in their own <code>&lt;section&gt;</code> tags. We use <a
href="https://github.com/weavejester/hiccup">Hiccup</a> to write HTML as
Clojure vectors; the <code>page/html5</code> function will turn our
vectors into HTML strings that are returned to the browser. For an
example, the vector <code>[:p (:content post)]</code> is roughly the
same as <code>(str "&lt;p&gt;" (:content post) "&lt;/p&gt;")</code>.</p>
<p>We use a <code>for</code> loop to turn each post into a vector.
<code>for</code> is Clojure syntax for a <em>list comprehension</em>.
The simple form of <code>for</code> we use here could be written as a
<code>map</code> call as well:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>(<span class="kw">for</span> [elem elems] (...))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>(<span class="kw">map</span> (<span class="kw">fn</span> [elem] (...)) elems)</span></code></pre></div>
<p>However, the <code>for</code> is more readable in this context. With
<code>map</code>, the <code>defpage</code> call would look like
this:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(defpage <span class="st">&quot;/&quot;</span> []</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  (page/html5</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">map</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>      (<span class="kw">fn</span> [post]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        [<span class="at">:section</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>          [<span class="at">:h2</span> (<span class="at">:title</span> post)]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>          [<span class="at">:p</span> (<span class="at">:content</span> post)]])</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>      *posts*)))</span></code></pre></div>
<p>The last function in our file is <code>-main</code>: it is the
function Clojure calls when we run the application with
<code>lein run</code>.</p>
</section>
</section>
<section id="adding-new-posts" class="level2">
<h2>Adding new posts</h2>
<p>Our first version of the blog was a good demonstration that we knew
how to wire together the libraries we use (noir, hiccup) and how to use
them to render posts to users.</p>
<p>Next we would like to add a feature to the blog that make it actually
useful: adding posts. We’d like the blog page to always show, at the
bottom, a form for adding a new post. The form should have two input
fields: one for the title of the post and one for the body content. The
form should also have a submit button that adds the post to the list of
posts.</p>
<p>Check out the <code>state</code> tag:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>git checkout state</span></code></pre></div>
<section id="implementation-requirements" class="level3">
<h3>Implementation requirements</h3>
<p>We need to implement two things: the form on the blog page, and an
endpoint that the form is POSTed to by the browser.</p>
</section>
<section id="the-form" class="level3">
<h3>The form</h3>
<p>We define the form in its own function for clarity:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(<span class="bu">defn</span><span class="fu"> add-form </span>[]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  [<span class="at">:section</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>   [<span class="at">:h2</span> <span class="st">&quot;Add post&quot;</span>]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>   (form-to [<span class="at">:post</span> <span class="st">&quot;/&quot;</span>]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>            (label <span class="st">&quot;title&quot;</span> <span class="st">&quot;Title&quot;</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>            [<span class="at">:br</span>]</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>            (text-field <span class="st">&quot;title&quot;</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>            [<span class="at">:br</span>]</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>            (label <span class="st">&quot;content&quot;</span> <span class="st">&quot;Content&quot;</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>            [<span class="at">:br</span>]</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>            (text-area <span class="st">&quot;content&quot;</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>            [<span class="at">:br</span>]</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>            (submit-button <span class="st">&quot;Add&quot;</span>))])</span></code></pre></div>
<p>We’ve put the form in its own <code>&lt;section&gt;</code> tag, and
we use <code>hiccup.form</code>’s <code>form-to</code> function to
define the form. The <code>[:br]</code> vectors make sure the form
elements are properly vertical.</p>
<p>If you think this definition is a bit ugly, you’re absolutely right.
We’ll fix it soon. However, we don’t yet have any way of delivering
style information with CSS to the browser. This was the quickest way of
adding a form, which we need right now to test the adding of posts.</p>
</section>
<section id="the-end-point" class="level3">
<h3>The end-point</h3>
<p>We declare a new page with <code>defpage</code> to handle the POST
submission from the form:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode clojure"><code class="sourceCode clojure"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>(defpage [<span class="at">:post</span> <span class="st">&quot;/&quot;</span>] {<span class="at">:keys</span> [title <span class="kw">content</span>]}</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  (<span class="kw">swap!</span> posts #(<span class="kw">conj</span> <span class="va">%</span> {<span class="at">:title</span> title <span class="at">:content</span> <span class="kw">content</span>}))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  (response/redirect <span class="st">&quot;/&quot;</span>))</span></code></pre></div>
<p>The first parameter to <code>defpage</code>,
<code>[:post "/"]</code>, declares that this page handels only HTTP POST
requests. The second parameter, <code>{:keys [title content]}</code>
extracts the <code>title</code> and <code>content</code> fields from the
POST request.</p>
<p>The next line adds a new post to the vector of posts. To understand
it, we need to introduce a new syntax form and a new concept.</p>
</section>
<section id="the-...-...-syntax" class="level3">
<h3>The <code>#(... % ...)</code> syntax</h3>
</section>
<section id="atoms" class="level3">
<h3>Atoms</h3>
</section>
</section>
<footer>
    <p>
        &copy; iloveponies

        <span style="float: right">
            <a href="mailto:juhana.laurinharju@cs.helsinki.fi">questions?</a>
        </span>
    </p>
</footer>
</div>
</div>
</body>
</html>
